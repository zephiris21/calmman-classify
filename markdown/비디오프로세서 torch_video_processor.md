# ì¹¨ì°©ë§¨ í‚¹ë°›ëŠ” ìˆœê°„ íƒì§€ ì‹œìŠ¤í…œ - ì„¤ëª…ì„œ

## ğŸ¯ í”„ë¡œì íŠ¸ ê°œìš”

ë³¸ í”„ë¡œì íŠ¸ëŠ” ì¹¨ì°©ë§¨ì˜ "í‚¹ë°›ëŠ” ìˆœê°„"ì„ ìë™ìœ¼ë¡œ íƒì§€í•˜ëŠ” ì‹œìŠ¤í…œì…ë‹ˆë‹¤. 


## ğŸš€ ì‹¤í–‰ ë°©ë²•

### ê¸°ë³¸ ì‹¤í–‰
```bash
# ê¸°ë³¸ ì„¤ì •ìœ¼ë¡œ ì‹¤í–‰ (config íŒŒì¼ì— ì§€ì •ëœ ì˜ìƒ)
python src/torch_video_processor.py

# íŠ¹ì • ì˜ìƒ íŒŒì¼ ì§€ì •
python src/torch_video_processor.py "ì¹¨ì°©ë§¨_ì˜ìƒ.mp4"

# ì»¤ìŠ¤í…€ ë””ë ‰í† ë¦¬ì™€ ì„¤ì • íŒŒì¼
python src/torch_video_processor.py ì˜ìƒíŒŒì¼.mp4 --dir /path/to/videos --config config/custom_config.yaml
```

### ì„¤ì • íŒŒì¼ ìˆ˜ì •
`config/config_torch.yaml`ì—ì„œ ë‹¤ìŒ í•­ëª©ë“¤ì„ ì¡°ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
- ë¹„ë””ì˜¤ ê²½ë¡œ ë° íŒŒì¼ëª…
- ì–¼êµ´ ì¸ì‹ í™œì„±í™”/ë¹„í™œì„±í™”
- ë°°ì¹˜ í¬ê¸° ë° ì„±ëŠ¥ ì„¤ì •
- ì¶œë ¥ ë””ë ‰í† ë¦¬ ì„¤ì •

## ğŸ§  ì‹œìŠ¤í…œ ë¡œì§ ì„¤ëª…

### 1. íŒŒì´í”„ë¼ì¸ êµ¬ì¡°

ë³¸ ì‹œìŠ¤í…œì€ **"Classifying Emotions and Engagement in Online Learning Based on a Single Facial Expression Recognition Neural Network"** ë…¼ë¬¸ì˜ ì•„í‚¤í…ì²˜ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•©ë‹ˆë‹¤.

```
ë…¼ë¬¸ì˜ ì›ë˜ íŒŒì´í”„ë¼ì¸:
ì–¼êµ´ íƒì§€ â†’ ê°ì • íŠ¹ì§• ì¶”ì¶œ â†’ í†µê³„ ì§‘ê³„ â†’ ì°¸ì—¬ë„ ì˜ˆì¸¡

ìš°ë¦¬ì˜ ë³€í˜•ëœ íŒŒì´í”„ë¼ì¸:
ì–¼êµ´ íƒì§€ â†’ ê°ì • íŠ¹ì§• ì¶”ì¶œ â†’ ë°°ì¹˜ ë¶„ë¥˜ â†’ í‚¹ë°›ëŠ” ìˆœê°„ íƒì§€
```

### 2. í•µì‹¬ ì»´í¬ë„ŒíŠ¸

#### A. ì–¼êµ´ íƒì§€ (MTCNN)
- **ì—­í• **: ë¹„ë””ì˜¤ í”„ë ˆì„ì—ì„œ ì–¼êµ´ ì˜ì—­ì„ íƒì§€í•˜ê³  224x224 í¬ê¸°ë¡œ ì •ê·œí™”
- **ë°°ì¹˜ ì²˜ë¦¬**: ì—¬ëŸ¬ í”„ë ˆì„ì„ ë™ì‹œì— ì²˜ë¦¬í•˜ì—¬ íš¨ìœ¨ì„± í–¥ìƒ
- **ë…¼ë¬¸ ì—°ê´€ì„±**: ë…¼ë¬¸ì˜ "Face detection" ë‹¨ê³„ì™€ ë™ì¼

#### B. ì–¼êµ´ ì¸ì‹ (FaceNet) - ì„ íƒì 
- **ì—­í• **: íƒì§€ëœ ì–¼êµ´ì´ ì¹¨ì°©ë§¨ì¸ì§€ í™•ì¸í•˜ì—¬ í•„í„°ë§
- **ì„¤ì •**: `config.yaml`ì˜ `face_recognition.enabled`ë¡œ í™œì„±í™”/ë¹„í™œì„±í™” ê°€ëŠ¥
- **ì¥ì **: ë‹¤ë¥¸ ì‚¬ëŒì˜ ì–¼êµ´ì„ ì œì™¸í•˜ì—¬ ì •í™•ë„ í–¥ìƒ

#### C. ê°ì • íŠ¹ì§• ì¶”ì¶œ (EfficientNet-B0)
- **í•µì‹¬ ì•„ì´ë””ì–´**: ë…¼ë¬¸ì˜ ê°ì • íŠ¹ì§• ì¶”ì¶œ ë„¤íŠ¸ì›Œí¬ë¥¼ ì¬í™œìš©
- **êµ¬ì¡°**: 
  - EfficientNet-B0 ë°±ë³¸ (ë…¼ë¬¸ì—ì„œ ì‚¬ìš©í•œ ê²½ëŸ‰ ëª¨ë¸)
  - ì‚¬ì „ í›ˆë ¨: ì–¼êµ´ ì¸ì‹ â†’ AffectNet ê°ì • ë°ì´í„°ì…‹ìœ¼ë¡œ ë¯¸ì„¸ ì¡°ì •
  - ì¶œë ¥: Softmax ì´ì „ ë‹¨ê³„ì˜ íŠ¹ì§• ë²¡í„° (ë…¼ë¬¸ê³¼ ë™ì¼)

#### D. ë°°ì¹˜ ë¶„ë¥˜
- **ë³€í˜• í¬ì¸íŠ¸**: ë…¼ë¬¸ì€ í†µê³„ ì§‘ê³„ í›„ íšŒê·€ ëª¨ë¸ì„ ì‚¬ìš©í–ˆì§€ë§Œ, ìš°ë¦¬ëŠ” ì§ì ‘ ì´ì§„ ë¶„ë¥˜
- **ëª¨ë¸**: EfficientNet-B0 + ì»¤ìŠ¤í…€ ë¶„ë¥˜ í—¤ë“œ
- **ì¶œë ¥**: í‚¹ë°›ëŠ” ì •ë„ì˜ í™•ë¥ ê°’ (0~1)

### 3. ë©€í‹°ìŠ¤ë ˆë”© ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  í”„ë ˆì„ ì½ê¸°  â”‚ â†’  â”‚  ì–¼êµ´ íƒì§€   â”‚ â†’  â”‚  ë°°ì¹˜ ë¶„ë¥˜   â”‚
â”‚   ìŠ¤ë ˆë“œ     â”‚    â”‚   ìŠ¤ë ˆë“œ     â”‚    â”‚   ìŠ¤ë ˆë“œ     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                   â”‚                   â”‚
       â–¼                   â–¼                   â–¼
  Frame Queue        Face Queue          Result Queue
```

**ì¥ì **:
- ê° ë‹¨ê³„ê°€ ë…ë¦½ì ìœ¼ë¡œ ì‹¤í–‰ë˜ì–´ ì „ì²´ ì²˜ë¦¬ ì†ë„ í–¥ìƒ
- GPUì™€ CPU ìì›ì„ íš¨ìœ¨ì ìœ¼ë¡œ í™œìš©
- ëŒ€ìš©ëŸ‰ ë¹„ë””ì˜¤ë„ ë©”ëª¨ë¦¬ ë¶€ì¡± ì—†ì´ ì²˜ë¦¬ ê°€ëŠ¥

### 4. e-learning ì°¸ì—¬ë„ ì¸¡ì • ë…¼ë¬¸ ë‚´ìš©ê³¼ê³¼ì˜ ì°¨ì´ì 

| êµ¬ë¶„ | ë…¼ë¬¸ (í•™ìƒ ì°¸ì—¬ë„) | ìš°ë¦¬ ì‹œìŠ¤í…œ (í‚¹ë°›ëŠ” ìˆœê°„) |
|------|------------------|-------------------------|
| **ëª©í‘œ** | ì°¸ì—¬ë„ ìˆ˜ì¤€ ì˜ˆì¸¡ (4ë‹¨ê³„) | í™”ë‚œ í‘œì • ì´ì§„ ë¶„ë¥˜ |
| **ì…ë ¥** | 5-10ì´ˆ ë¹„ë””ì˜¤ í´ë¦½ | ê°œë³„ í”„ë ˆì„ |
| **íŠ¹ì§• ì§‘ê³„** | í‘œì¤€í¸ì°¨ ë“± í†µê³„ í•¨ìˆ˜ | ì§ì ‘ ë¶„ë¥˜ (ì§‘ê³„ ì—†ìŒ) |
| **ëª¨ë¸** | íšŒê·€ ëª¨ë¸ (Ridge) | ì´ì§„ ë¶„ë¥˜ (Neural Net) |
| **ë°ì´í„°ì…‹** | EngageWild | ì»¤ìŠ¤í…€ ì¹¨ì°©ë§¨ ë°ì´í„° |

### 5. ë°ì´í„° íë¦„

```python
# 1. í”„ë ˆì„ ì¶”ì¶œã„´ã„´
frame_rgb = cv2.cvtColor(frame, cv2.COLOR_BGR2RGB)

# 2. ì–¼êµ´ íƒì§€ (MTCNN ë°°ì¹˜)
face_images = face_detector.process_image_batch(frames)

# 3. ì–¼êµ´ ì¸ì‹ í•„í„°ë§ (ì„ íƒì )
if face_recognition_enabled:
    embeddings = facenet_model(face_images)
    similarities = cosine_similarity(embeddings, target_embedding)
    filtered_faces = faces[similarities > threshold]

# 4. ê°ì • ë¶„ë¥˜ (EfficientNet ë°°ì¹˜)
features = efficientnet_backbone(face_images)  # ë…¼ë¬¸ì˜ ê°ì • íŠ¹ì§•
predictions = classifier_head(features)        # ìš°ë¦¬ì˜ í‚¹ë°›ëŠ” ë¶„ë¥˜
angry_probability = softmax(predictions)[:, 1]
```

## ğŸ“Š ì¶œë ¥ ê²°ê³¼

- **í•˜ì´ë¼ì´íŠ¸ ì´ë¯¸ì§€**: `results/ë‚ ì§œ_ì˜ìƒëª…/highlights/` - í‚¹ë°›ëŠ” ìˆœê°„ì˜ ì–¼êµ´ ì´ë¯¸ì§€
- **íƒ€ì„ìŠ¤íƒ¬í”„ JSON**: `angry_moments.json` - ì •í™•í•œ ì‹œê°„ê³¼ ì‹ ë¢°ë„ ì •ë³´
- **ì²˜ë¦¬ ë¡œê·¸**: ìƒì„¸í•œ ì²˜ë¦¬ ê³¼ì •ê³¼ ì„±ëŠ¥ í†µê³„
- **í•„í„°ë§ëœ ì–¼êµ´**: ì¸ì‹ë˜ì§€ ì•Šì€ ì–¼êµ´ë“¤ (ë””ë²„ê¹…ìš©, ì˜µì…˜)

## âš™ï¸ ì£¼ìš” ì„¤ì • ì˜µì…˜

```yaml
face_recognition:
  enabled: true              # ì–¼êµ´ ì¸ì‹ í™œì„±í™”
  test_mode: false          # í…ŒìŠ¤íŠ¸ ëª¨ë“œ (í•„í„°ë§ ê±´ë„ˆëœ€)
  similarity_threshold: 0.6  # ìœ ì‚¬ë„ ì„ê³„ê°’

classifier:
  batch_size: 8             # ë¶„ë¥˜ ë°°ì¹˜ í¬ê¸°
  confidence_threshold: 0.7  # í‚¹ë°›ëŠ” íŒì • ì„ê³„ê°’

performance:
  max_queue_size: 100       # í ìµœëŒ€ í¬ê¸° (ë©”ëª¨ë¦¬ ê´€ë¦¬)
```

## ğŸ”§ ë¬¸ì œ í•´ê²°

- **ë©”ëª¨ë¦¬ ë¶€ì¡±**: `batch_size`ì™€ `max_queue_size` ì¤„ì´ê¸°
- **ëŠë¦° ì²˜ë¦¬**: `frame_skip` ëŠ˜ë¦¬ê±°ë‚˜ ì–¼êµ´ ì¸ì‹ ë¹„í™œì„±í™”
- **ì •í™•ë„ ë‚®ìŒ**: `confidence_threshold` ì¡°ì • ë˜ëŠ” ì–¼êµ´ ì¸ì‹ í™œì„±í™”
- **CUDA ì˜¤ë¥˜**: `device: cpu`ë¡œ ì„¤ì •í•˜ì—¬ CPU ëª¨ë“œë¡œ ì‹¤í–‰
